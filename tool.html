<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Wasser-facts-Tool</title>

    <!-- Load Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Load external CSS File -->
    <link rel="stylesheet" href="tool.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.24.0/d3-legend.js"></script>

</head>
<body class="backgroundMap">
<div class="container-fluid mt-3">
    <div class="row">


        <!-- The middle of the site with header, function and card!-->
        <div class="col">
            <!-- header with the logo and the button -->
            <header>
                <div class="d-flex justify-content-between content-header">
                    <div class="p-2">
                        <!--                        <img src="./img/Logo_klein.png">-->
                        <a class="" id="logo" href="index.html">Wer? Wie? <br/>Was? Wasser?</a>
                    </div>
                    <div style="margin-right:50px">
                        <a type="button" class="btn fontText" href="about.html" role="button" id="btn-tool">Über das
                            Projekt</a>
                    </div>
                </div>
            </header>
            <!--  the content-->
            <div class="mt-3 fontText content-map">
                <!--  the switch buttons product, waterstrees, wwf -->
                <div class="">
                    <div class="form-check form-check-inline pr-5 map-settings">
                        <label class="pr-2">Wasserstress
                            <sup>
                                <i id="infoWaterStress" class='fa fa-fw fa-info-circle infoBtn' style="color:#0AA7FF">
                                    <span class="tooltiptext fontText">Absinken des Wasserpotentials bei Pflanzen aufgrund Wassermangels (Dürre).</span>
                                </i>
                            </sup>
                        </label>
                        <label class="switch">
                            <input type="checkbox" class="checkbox" value="waterStress">
                            <span class="slider round"></span>
                        </label>
                    </div>

                    <div class="form-check form-check-inline pr-5 map-settings">
                        <label class="pr-2">Virtuelles Wasser
                            <sup>
                                <i id="infoVirtualWater" class='fa fa-fw fa-info-circle infoBtn' style="color:#0AA7FF">
                                    <span class="tooltiptext tooltiptext-2 fontText">Indirekter Wasserkonsum Deutschlands (virtuelles Wasser) durch importierte Produkte.</span>
                                </i>
                            </sup>
                        </label>
                        <label class="switch">
                            <input type="checkbox" class="checkbox" value="virtualWater">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <label class="pr-1">Produkte</label>
                    <sup>
                        <i>
                            <i class='fa fa-fw fa-info-circle infoBtn' style="color:#0AA7FF">
                                <span class="tooltiptext tooltiptext-3 fontText">Diese Produkte haben einen sehr hohen Wasser-<br>verbrauch bei der Herstellung. Sie zählen durch den hohen Konsum der deutschen Bevölkerung als beliebtes Produkt.</span>
                            </i>
                        </i>
                    </sup>
                    <div class="form-check form-check-inline">
                        <label class="pr-2 pl-2 fontProduct">Kaffee
                        </label>
                        <label class="switch">
                            <input type="checkbox" class="checkbox product" value="coffee">
                            <span class="slider round coffee"></span>
                        </label>
                    </div>

                    <div class="form-check form-check-inline">
                        <label class="pr-2 fontProduct">Reis
                        </label>
                        <label class="switch">
                            <input type="checkbox" class="checkbox product" value="rice">
                            <span class="slider round rice"></span>
                        </label>
                    </div>

                    <div class="form-check form-check-inline">
                        <label class="pr-2 fontProduct">Baumwolle
                        </label>
                        <label class="switch">
                            <input type="checkbox" class="checkbox product" value="cotton">
                            <span class="slider round cotton"></span>
                        </label>
                    </div>
                </div>
                <hr class="hrTool ">
                <div class="row content-only-map">
                    <div class="col text-left">
                        <!-- the legend placeholder-->
                        <div class="row tooltipBox">
                            <div class="col">
                                <span class="close">&times;</span>
                                <div class="row" id="America">
                                    <p class="map-info-headline">Amerika</p>
                                    <hr class="map-info-line">
                                    <p class=" map-info-text">
                                        Amerika ist mit einem Wasserexport von <span style="color: #0AA7FF">2,76 km&sup3; pro Jahr</span>
                                        an f&uuml;nfter Stelle des h&ouml;chsten externen Wasserfußabdrucks
                                        Deutschlands. Dazu z&auml;hlen Produkte, wie Soja, N&uuml;sse, Sonnenblumen,
                                        &Ouml;lsat, Reis, Baumwolle, Erdn&uuml;sse und Tabak.
                                        Vor allem <span style="color: #0AA7FF">Reis verbraucht</span> durch den Anbau
                                        der traditionellen Methode <span style="color: #0AA7FF">durch &Uuml;berflutung der Felder viel Wasser.</span>
                                    </p>
                                </div>
                                <div class="row" id="Brazil">
                                    <p class="map-info-headline">Brasilien</p>
                                    <hr class="map-info-line">
                                    <p class="map-info-text">
                                        Brasilien steckt in einer <span style="color: #0AA7FF">Wasserkrise,</span>
                                        obwohl es <span
                                            style="color: #0AA7FF">durch den Amazonas ein wasserreiches Land</span> ist.
                                        Es hat vor allem aufgrund der Wasserverschmutzung
                                        und dessen Folgen Probleme mit seinen Wasserressourcen. Deutschland importiert
                                        mit <span style="color: #0AA7FF">5,73 km&sup3; pro Jahr</span> am meisten Wasser
                                        aus Brasilien, darunter Produkte
                                        wie Kaffe, Soja und Vieh. Vor allem der <span style="color: #0AA7FF">Sojaanbau tr&auml;gt zur Zerst&ouml;rung des Amazonas</span>
                                        aufgrund der j&auml;hrlichen Rodung von <span style="color: #0AA7FF">1,4 Millionen Hektar bei.</span>
                                    </p></div>
                                <div class="row" id="India">
                                    <p class="map-info-headline">Indien</p>
                                    <hr class="map-info-line">
                                    <p class="map-info-text">
                                        Indien z&auml;hlt mit einem Wasserexport von <span style="color: #0AA7FF">2,18 km&sup3; pro Jahr</span>
                                        nach Deutschland nicht zu den h&ouml;chsten externen Wasserfußabdruck. Das Land
                                        ist jedoch aufgrund seines <span style="color: #0AA7FF">Wassermangels</span>
                                        kritisch zu betrachten.
                                        <span style="color: #0AA7FF">Aufgrund der Niederschl&auml;ge</span> wird <span
                                            style="color: #0AA7FF">lediglich 60 % der Bew&auml;sserung</span> geliefert.
                                        Neben Produkten wie &Ouml;lsaat, Kaffee und Nüssen gilt Baumwolle mit ca. 9
                                        Millionen Hektar Anbaufl&auml;che als
                                        wichtigster Wirtschaftsfaktor Indiens, obwohl das Land die niedrigsten Ernteertr&auml;ge
                                        weltweit aufweist. Folgen des Baumwolleanbaus sind <span style="color: #0AA7FF">stark verschmutzte Gew&auml;sser</span>
                                        und <span style="color: #0AA7FF">Senkung Grundwasservorkommen.</span>
                                    </p>
                                </div>
                                <div class="row" id="Kenia">
                                    <p class="map-info-headline">Kenia</p>
                                    <hr class="map-info-line">
                                    <p class="map-info-text">
                                        Kenia hat einen <span style="color: #0AA7FF">j&auml;hrlichen Wasserbedarf</span>
                                        von <span style="color: #0AA7FF">2,7 km&sup3;.</span> Zudem weist das Land eine
                                        stetig steigende <span style="color: #0AA7FF">Verschlechterung der Trinkwasservesorgung</span>
                                        auf.
                                        Durch die hohe Bev&ouml;lkerungswachstumsrate sinkt die verf&uuml;gbare
                                        Wassermenge bis 2025 rapide. Der Export <span style="color: #0AA7FF">landwirtschaftlicher G&uuml;ter</span>
                                        ist mit 60 % die
                                        <span style="color: #0AA7FF">wichtigste Exporteinnahme.</span> Hierzu z&auml;hlt
                                        &uuml;berwiegend der gartenbauliche Bereich wie z. B. Schnittblumen (> 50%).
                                        Neben diesen Produkten z&auml;hlt ebenso
                                        <span style="color: #0AA7FF">Kaffee</span> mit einem Wasserexport von <span
                                            style="color: #0AA7FF">488 Mm&sup3; Jahr</span> als wichtigstes Exportgut.
                                        Kenia ist zudem <span style="color: #0AA7FF">auf die unzuverl&auml;ssigen Niederschl&auml;ge</span>
                                        im Land <span style="color: #0AA7FF">angewiesen.</span>
                                    </p>
                                </div>
                                <div class="row" id="Spain">
                                    <p class="map-info-headline">Spanien</p>
                                    <hr class="map-info-line">
                                    <p class="map-info-text">
                                        Spanien ist <span style="color: #0AA7FF">von der EU das Land,</span> welches am
                                        <span style="color: #0AA7FF">st&auml;rksten von der Trockenheit betroffen</span>
                                        ist und dennoch den gr&ouml;ßten Anbau der Obst- und Gem&uuml;seproduktion f&uuml;r
                                        den europ&auml;ischen Markt betreibt. Weitere Produkte wie N&uuml;sse, Schweine
                                        & Co sind ebenso wichtige Importg&uuml;ter Deutschlands, weshalb <span
                                            style="color: #0AA7FF">Deutschland</span> einen <span
                                            style="color: #0AA7FF">externen Wasserfußabdruck von 1,83 km&sup3; pro Jahr</span>
                                        hinterl&auml;sst. Für die j&auml;hrliche Bew&auml;sserung von 3,3 Millionen
                                        Hektar Land werden 24 km&sup3; Wasser ben&ouml;tigt. Doch nicht nur die <span
                                            style="color: #0AA7FF">verschwenderische Bew&auml;sserung</span> in
                                        Form von &Uuml;berflutung der Felder, sondern auch die <span
                                            style="color: #0AA7FF">illegale Nutzung</span> von Oberfl&auml;chen- und
                                        Grundwasser stellt ein <span style="color: #0AA7FF">großes Problem</span> dar.
                                    </p>
                                </div>
                                <div class="row" id="Turkei">
                                    <p class="map-info-headline">Türkei</p>
                                    <hr class="map-info-line">
                                    <p class="map-info-text">
                                        Deutschland hinterl&auml;sst in der T&uuml;rkei einen <span
                                            style="color: #0AA7FF">externen Wasserfußabdruck von 1,87 km&sup3; pro Jahr.</span>
                                        Dazu z&auml;hlen Produkte wie Baumwolle, N&uuml;sse, Trauben & Co
                                        als wichtigste Importg&uuml;ter für Deutschland. Vor allem <span
                                            style="color: #0AA7FF">Baumwolle ist mit 700.000 Hektar Land</span> und
                                        einem <span style="color: #0AA7FF">j&auml;hrlichen Anbau von 2,3 Millionen Tonnen</span>
                                        Baumwolle
                                        ein wichtiges Erzeugnis. Für dieses und viele weitere Produkte werden <span
                                            style="color: #0AA7FF">hohe Wassermengen benutzt,</span> wodurch die
                                        Grundwasserressourcen immer st&auml;rker &uuml;bernutzt werden.
                                        Durch die <span style="color: #0AA7FF">unzureichende Niederschlagsmengen</span>
                                        sowie <span style="color: #0AA7FF">illegale Wasserentnahmen</span> werden
                                        Grundwasserk&ouml;rper nicht ausreichend aufgef&uuml;llt.
                                    </p></div>
                                <div class="row" id="Italia">
                                    <p class="map-info-headline">Italien</p>
                                    <hr class="map-info-line">
                                    <p class="map-info-text">
                                        In der EU ist Italien mit der Produktion von Reis mit einem Anteil von Zwei
                                        Drittel das wichtigste Anbauland. <span style="color: #0AA7FF">Deutschland importiert durch Reis</span>
                                        insgesamt <span style="color: #0AA7FF">120 Mm&sup3; Wasser im Jahr</span>
                                        von Italien. Weitere Produkte wie Trauben, &Ouml;lsaat, Rind, Schweine & Co
                                        tragen zu einem <span style="color: #0AA7FF">externen Wasserfußabdruck von 1,74 km&sup3; pro Jahr</span>
                                        Deutschlands bei. Darunter z&auml;hlt
                                        <span style="color: #0AA7FF">Reis</span> aufgrund der hohen ben&ouml;tigten
                                        Wassermenge <span style="color: #0AA7FF">als kritischstes Produkt.</span> Der
                                        Reis wird in der am st&auml;rksten landwirtschaftlichen genutzten Fl&auml;che,
                                        dem <span style="color: #0AA7FF">Po-Becken,</span> angebaut.
                                        Dieses Areal hat aufgrund der <span style="color: #0AA7FF">D&uuml;rre</span> und
                                        dem <span style="color: #0AA7FF">Salzeintrag schlechte Bedingungen für den Anbau.</span>
                                    </p></div>
                            </div>
                        </div>
                        <div class="row  legendContainer">
                            <!--  waterstress legend-->
                            <div id="legende-waterstress">
                                <div class="row justify-content-start">
                                    <div class="col-6">
                                        <p class="legende-headline">Wasserstress-Legende</p>
                                        <div id="legende-content-boxes">
                                            <div id="extrem-high">
                                            </div>
                                            <div id="high">
                                            </div>
                                            <div id="middle">
                                            </div>
                                            <div id="low">
                                            </div>
                                            <div id="very-low">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row justify-content-start">
                                    <div class="col-6">
                                        <div class="legende-content-text">
                                            <p class="legende-waterstress-text">
                                                extrem hoch<br>(>80%)
                                            </p>
                                        </div>
                                        <div class="legende-content-text">
                                            <p class="legende-waterstress-text">
                                                hoch<br>(40-80%)
                                            </p>
                                        </div>
                                        <div class="legende-content-text">
                                            <p class="legende-waterstress-text">
                                                mittel<br>(20-40%)
                                            </p>
                                        </div>
                                        <div class="legende-content-text">
                                            <p class="legende-waterstress-text">
                                                niedrig<br>(10-20%)
                                            </p>
                                        </div>
                                        <div class="legende-content-text">
                                            <p class="legende-waterstress-text">
                                                sehr niedrig<br>(<10%)
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- wwf-legend-->
                            <div id="legende-virtuelleswasser" class="">
                                <div class="row justify-content-start">
                                    <div class="col-6">
                                        <p class="legende-headline">Virtuelles Wasser-Legende</p>
                                        <div id="legende-content-boxes-vw">
                                            <div id="high-vw">
                                            </div>
                                            <div id="middle-vw">
                                            </div>
                                            <div id="low-vw">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row justify-content-start">
                                    <div class="col-6">
                                        <div class="legende-content-text">
                                            <p class="legende-vw-text">
                                                >4,96 km&sup3; Wasser<br>Export &rarr; Import
                                            </p>
                                        </div>
                                        <div class="legende-content-text">
                                            <p class="legende-vw-text">
                                                >0,13 km&sup3; Wasser<br>Export &rarr; Import
                                            </p>
                                        </div>
                                        <div class="legende-content-text">
                                            <p class="legende-vw-text">
                                                <0,08 km&sup3; Wasser<br>Export &rarr; Import
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Card-->
                    <div class="col text-center" id="map">
                        <svg id="tool" width="900" height="670"></svg>
                    </div>
                    <!-- BtnZoom-->
                    <div class="col">
                        <!--  the box for the info about the country-->
                        <!--hier -->
                        <div id="" class="row btn-group-vertical p-2 btnZoomGroup">
                            <button class="btn btnZoom" id="zoom-in">
                                <img src="./img/plus.svg" id="plus-svg">
                            </button>
                            <button class="btn btnZoom" id="zoom-out">
                                <img src="./img/minus.svg" id="minus-svg">
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--right switch button -->
        <div class="col-1 position-fixed" id="swB">
            <a type="button" href="ausblick.html" class="switchbutton-right" role="button">
                <p class="switchbutton-text-right">Ausblick</p>
                <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor"
                     class="bi-chevron-right svgB" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                          d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                </svg>
            </a>
        </div>
        <!--left switch button -->
        <div class="col-1 position-fixed" id="swB">
            <a type="button" class="switchbutton-left" href="index.html" role="button">
                <p class="switchbutton-text-left">Einf&uuml;hrung</p>
                <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class=" bi-chevron-left svgB" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                </svg>
            </a>
        </div>
    </div>

</div>

<div class="container-fluid d-flex justify-content-center" id="footer">
    <div class="row">
        <footer class="col-12" id="footer-content">
            <a href="impressum.html" id="footer-text">
                Impressum
            </a>
            <a href="datenschutz.html" id="footer-text">
                Datenschutz
            </a>
        </footer>
    </div>
</div>

<script>
    /** World map*/
    let Worldmap;

    /**
     * Maps for the dataset
     */
    let introData = d3.map();
    let waterStressData = d3.map();

    /**
     *
     * */
    var link = [];

    /**
     * Tooltip
     */
    let tooltip = d3.select('body')
        .append('div')
        .attr('class', 'tooltip')
        .style("opacity", 0);

    /**
     * ColorScaleWaterstress
     */
    let colorScaleWaterstress = d3.scaleThreshold()
        .domain([0, 1, 2, 3, 4])
        .range(["#7C7C7C", "#ACCFDD", "#5BA8D3", "#2A92D8", "#055BDC", "#023784"]);


    /**
     * SVG
     */
    let svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height")


    /**
     * Read the file
     */

    d3.queue()
        .defer(d3.json, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
        .defer(d3.csv, "data/introData.csv", function (d) {
            introData.set(d.code,
                {"state": d.name, "text": d.text});

        })
        .defer(d3.csv, "data/countryWaterStress.csv", function (d) {
            waterStressData.set(d.code, +d.score)
        })
        .await(ready);
    console.log("introData", introData);


    /*
    Create Projection using Mercartor (geoMercator)
    and center it (translate) and zoom in a certain amount (scale)
     */
    let projection = d3.geoMercator()
        .scale(150)
        .translate([490, 480]);

    /*
   Create a geoPath using the projection
    */
    var path = d3.geoPath()
        .projection(projection);

    /**
     * G Gruppen
     */
    let g1 = svg.append("g");
    let g2 = svg.append("g");
    let g3 = svg.append("g");
    let zoomZone = svg.append("g");


    /**
     * Marker for the products.
     * */
    var markers = [
        {long: -72, lat: 4, group: "coffee", size: 41, state: "Kolumbien", value: 1.03}, // Colombia
        {long: 120, lat: -5, group: "coffee", size: 30, state: "Indonesien", value: 0.77}, // Indonesia
        {long: -76, lat: -10, group: "coffee", size: 22, state: "Peru", value: 0.55}, // Peru
        {long: -55, lat: -10, group: "coffee", size: 100, state: "Brasilien ", value: 2.65}, // Brazil
        {long: 38, lat: 1, group: "coffee", size: 20, state: "Kenia", value: 0.45}, // Kenya
        {long: 77, lat: 20, group: "coffee", size: 8, state: "Indien ", value: 0.21}, // India
        {long: 1.17, lat: 8, group: "rice", size: 6, state: "Togo", value: 0.15}, // Togo
        {long: 12.83, lat: 42.83, group: "rice", size: 4, state: "Italien", value: 0.12}, // Italy
        {long: 77, lat: 20, group: "cotton", size: 39, state: "Indien", value: 0.99}, // India
        {long: 35, lat: 39, group: "cotton", size: 30, state: "T&uuml;rkei", value: 0.76}, // Turkey
        {long: 70, lat: 30, group: "cotton", size: 15, state: "Pakistan", value: 0.36}, // Pakistan
        {long: 64, lat: 41, group: "cotton", size: 14, state: "Uzbekistan", value: 0.35}, // Uzbekistan
        {long: 90, lat: 24, group: "cotton", size: 14, state: "Bangladesh", value: 0.34}, // Bangladesh
        {long: 105, lat: 35, group: "cotton", size: 13, state: "China", value: 0.32} // China
    ];


    /* Color for the products */
    var color = d3.scaleOrdinal()
        .domain(["coffee", "rice", "cotton"])
        .range(["#FFAC27", "#C73737", "#FF2EFF"])

    // Add a scale for bubble size
    var size = d3.scaleLinear()
        .domain([1, 100])  // What's in the data
        .range([4, 50])  // Size in pixel


    // Zoom function
    var zoom = d3.zoom()
        .scaleExtent([1, 2])
        .extent([[0, 0], [900, 670]])
        .on("zoom", zoomed);


    function zoomed() {
        var transform = d3.event.transform;
        g1.attr("transform", transform);
    }


    /**
     *
     * @param error
     * @param topo
     * @param data1
     * @param data2
     * @param wwf
     */

    function ready(error, topo, data1, data2, wwf) {
        let countries = topo.features;

        let virtualWaterFar = [
            {id: 1, coord: {type: "LineString", coordinates: [[9, 51], [-97, 38]]}}, // USA 121 hoch
            {id: 2, coord: {type: "LineString", coordinates: [[9, 51], [-55, -10]]}}, // Brazil 0,42 mittel
            {id: 3, coord: {type: "LineString", coordinates: [[9, 51], [38, 1]]}}, // Kenia 0,0003 low
            {id: 1, coord: {type: "LineString", coordinates: [[9, 51], [77, 20]]}} // India 94,31 hoch

        ]
        let virtualWaterClose = [
            {id: 1, coord: {type: "LineString", coordinates: [[35, 57], [10, 30]]}}, // Spain 10 30 77,40 hoch
            {id: 1, coord: {type: "LineString", coordinates: [[35, 57], [40, 40]]}}, // Italia 20 50 34,03 hoch
            {id: 1, coord: {type: "LineString", coordinates: [[35, 57], [80, 25]]}}, // Turkey 29,28 hoch
        ];


        worldmap = g1
            .selectAll(".country")
            .data(countries)
            .enter()
            .append("path")
            // Draw each country
            .attr("class", "country")
            .attr("d", path)
            .attr("fill", "#9CB6DB")
            .attr("stroke", strokeColorCountry)
            .attr("stroke-width", strokeWidthCountry)
            .on('click', showCountryBox);
        const toolButtons = d3.selectAll('.switch .checkbox').on("change", function (d) {
            const selection = this.value;
        });
        toolButtons.on('change', function (d) {
            if (this.value === "waterStress") {
                console.log('button changed to ' + 'waterStress');
                if (d3.select(this).property("checked")) {
                    console.log('true');
                    // d3.select('#infoWaterStress')
                    // .style("visibility", "visible")
                    d3.select('#legende-waterstress').style("display", "block");
                    worldmap.attr("fill", function (d) {
                        d.total = waterStressData.get(d.id) || 0;
                        return colorScaleWaterstress(d.total);
                    });
                } else {
                    worldmap.attr("fill", "#9CB6DB")
                        .style("stroke", "#fff")
                    d3.select('#legende-waterstress').style("display", "none");
                }
            }

            if (this.value === "virtualWater") {
                console.log('button changed to ' + 'wwf');
                if (d3.select(this).property("checked")) {
                    d3.select("#legende-virtuelleswasser").style("display", "block");
                    linePathFar = g2.selectAll("myPath")
                        .data(virtualWaterFar)
                        .enter()
                        .append("path")
                        .attr("d", function (d) {
                            console.log('path', d.coord);
                            return path(d.coord)
                        })
                        .style("fill", "none")
                        .style("stroke", colorLine)
                        .style("stroke-width", 3)

                    d3.select('#zoom-in').on('click', function () {
                        // Smooth zooming

                        zoom.scaleBy(g1.transition().duration(750), 5);

                        linePathFar.remove();
                        linePathClose = g2.selectAll("myPath")
                            .data(virtualWaterClose)
                            .enter()
                            .append("path")
                            .attr("d", function (d) {
                                return path(d.coord)
                            })
                            .style("fill", "none")
                            .style("stroke", colorLine)
                            .style("stroke-width", 3)

                    });

                    d3.select('#zoom-out').on('click', function () {
                        // Ordinal zooming
                        zoom.scaleBy(g1, 1 / 5);
                        linePathFar = g2.selectAll("myPath")
                            .data(virtualWaterFar)
                            .enter()
                            .append("path")
                            .attr("d", function (d) {
                                return path(d.coord)
                            })
                            .style("fill", "none")
                            .style("stroke", colorLine)
                            .style("stroke-width", 3)
                        linePathClose.remove();
                    });


                } else {
                    linePathFar.remove();

                    d3.select("#legende-virtuelleswasser").style("display", "none");

                    console.log('false');
                }


            }


        })


        // Add Circles
        g3
            .selectAll("myCircles")
            .data(markers)
            .enter()
            .append("circle")
            .attr("class", function (d) {
                return d.group
            })
            .attr("cx", function (d) {
                return projection([d.long, d.lat])[0]
            })
            .attr("cy", function (d) {
                return projection([d.long, d.lat])[1]
            })
            .attr("r", function (d) {
                return size(d.size)
            })
            .style("fill", function (d) {
                return color(d.group)
            })
            .attr("stroke", function (d) {
                return color(d.group)
            })
            .attr("stroke-width", 4)
            .attr("fill-opacity", .8)
            .attr("stroke-opacity", .2)
            .on("mouseover", function (d) {
                console.log('color', color(d.group))
                tooltip.transition()
                    .duration(200)
                    .style("opacity", .9);
                tooltip.html("<span style= 'font-size:15px'><i class=\"fa fa-tint\" aria-hidden=\"true\"></i> &nbsp " + d.state + "</span>"
                    + "<br/>" +
                    +d.value + 'km&sup3; Wasser/Jahr')
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px")
            })
            .on("mouseout", function () {
                tooltip.transition()
                    .duration(500)
                    .style("opacity", 0);
            })

        d3.selectAll(".checkbox.product").on("change", updateCircle);
        updateCircle();

    }

    function updateCircle() {
        d3.selectAll(".checkbox.product").each(function (d) {
            cb = d3.select(this);
            grp = cb.property("value");
            // If the box is check, I show the group
            if (cb.property("checked")) {
                console.log('cb selected', cb.property("value"));
                g3.selectAll("." + grp).transition().duration(1000).style("opacity", 1).attr("r", function (d) {
                    return size(d.size)
                })
                // Otherwise I hide it
            } else {
                g3.selectAll("." + grp).style("opacity", 0).attr("r", 0)
            }
        })
    }


    function strokeColorCountry(country) {
        if (introData.has(country.id)) {
            return '#FFFFFF';
        } else {
            return;
        }
    }

    function strokeWidthCountry(country) {
        if (introData.has(country.id)) {
            return '2';
        } else {
            return '0.3';
        }
    }

    function showCountryBox(country) {
        if (country.id === "USA") {
            console.log("country.id", country.id);
            d3.select(".tooltipBox").style("display", "block");
            d3.select("#America").style("display", "block");
            d3.select(".close").on('click', function () {
                d3.select(".tooltipBox").style('display', 'none');
                d3.select("#America").style('display', 'none');

            })
        }
        if (country.id === "BRA") {
            d3.select(".tooltipBox").style("display", "block");
            d3.select("#Brazil").style("display", "block");
            d3.select(".close").on('click', function () {
                d3.select(".tooltipBox").style('display', 'none');
                d3.select("#Brazil").style('display', 'none');

            })
        }
        if (country.id === "IND") {
            d3.select(".tooltipBox").style("display", "block");
            d3.select("#India").style("display", "block");
            d3.select(".close").on('click', function () {
                d3.select(".tooltipBox").style('display', 'none');
                d3.select("#India").style('display', 'none');

            })
        }
        if (country.id === "KEN") {
            d3.select(".tooltipBox").style("display", "block");
            d3.select("#Kenia").style("display", "block");
            d3.select(".close").on('click', function () {
                d3.select(".tooltipBox").style('display', 'none');
                d3.select("#Kenia").style('display', 'none');

            })
        }
        if (country.id === "ESP") {
            d3.select(".tooltipBox").style("display", "block");
            d3.select("#Spain").style("display", "block");
            d3.select(".close").on('click', function () {
                d3.select(".tooltipBox").style('display', 'none');
                d3.select("#Spain").style('display', 'none');

            })
        }
        if (country.id === "TUR") {
            d3.select(".tooltipBox").style("display", "block");
            d3.select("#Turkei").style("display", "block");
            d3.select(".close").on('click', function () {
                d3.select(".tooltipBox").style('display', 'none');
                d3.select("#Turkei").style('display', 'none');

            })
        }
        if (country.id === "ITA") {
            d3.select(".tooltipBox").style("display", "block");
            d3.select("#Italia").style("display", "block");
            d3.select(".close").on('click', function () {
                d3.select(".tooltipBox").style('display', 'none');
                d3.select("#Italia").style('display', 'none');

            })
        }
    }

    function colorLine(data) {
        if (data.id === 1) {
            // If high value
            return "rgba( 180,15,15,1)";
        }

        if (data.id === 2) {
            // if average value
            return "rgba(239,183,151,1)"
        }

        if (data.id === 3) {
            // if low value
            return "rgba(221,74,64,1)"
        }
    }


</script>

</body>
</html>